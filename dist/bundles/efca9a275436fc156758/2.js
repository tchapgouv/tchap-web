(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{594:function(e,r,t){"use strict";function n(e,r,t){return r<=e&&e<=t}function i(e){if(void 0===e)return{};if(e===Object(e))return e;throw TypeError("Could not convert argument to dictionary")}t.r(r),t.d(r,"TextEncoder",(function(){return u})),t.d(r,"TextDecoder",(function(){return s}));function o(e){this.tokens=[].slice.call(e)}o.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.shift():-1},prepend:function(e){if(Array.isArray(e))for(var r=e;r.length;)this.tokens.unshift(r.pop());else this.tokens.unshift(e)},push:function(e){if(Array.isArray(e))for(var r=e;r.length;)this.tokens.push(r.shift());else this.tokens.push(e)}};function a(e,r){if(e)throw TypeError("Decoder error");return r||65533}function s(e,r){if(!(this instanceof s))return new s(e,r);if("utf-8"!==(e=void 0!==e?String(e).toLowerCase():"utf-8"))throw new Error("Encoding not supported. Only utf-8 is supported");r=i(r),this._streaming=!1,this._BOMseen=!1,this._decoder=null,this._fatal=Boolean(r.fatal),this._ignoreBOM=Boolean(r.ignoreBOM),Object.defineProperty(this,"encoding",{value:"utf-8"}),Object.defineProperty(this,"fatal",{value:this._fatal}),Object.defineProperty(this,"ignoreBOM",{value:this._ignoreBOM})}function u(e,r){if(!(this instanceof u))return new u(e,r);if("utf-8"!==(e=void 0!==e?String(e).toLowerCase():"utf-8"))throw new Error("Encoding not supported. Only utf-8 is supported");r=i(r),this._streaming=!1,this._encoder=null,this._options={fatal:Boolean(r.fatal)},Object.defineProperty(this,"encoding",{value:"utf-8"})}function f(e){var r=e.fatal,t=0,i=0,o=0,s=128,u=191;this.handler=function(e,f){if(-1===f&&0!==o)return o=0,a(r);if(-1===f)return-1;if(0===o){if(n(f,0,127))return f;if(n(f,194,223))o=1,t=f-192;else if(n(f,224,239))224===f&&(s=160),237===f&&(u=159),o=2,t=f-224;else{if(!n(f,240,244))return a(r);240===f&&(s=144),244===f&&(u=143),o=3,t=f-240}return t<<=6*o,null}if(!n(f,s,u))return t=o=i=0,s=128,u=191,e.prepend(f),a(r);if(s=128,u=191,t+=f-128<<6*(o-(i+=1)),i!==o)return null;var c=t;return t=o=i=0,c}}function c(e){e.fatal;this.handler=function(e,r){if(-1===r)return-1;if(n(r,0,127))return r;var t,i;n(r,128,2047)?(t=1,i=192):n(r,2048,65535)?(t=2,i=224):n(r,65536,1114111)&&(t=3,i=240);for(var o=[(r>>6*t)+i];t>0;){var a=r>>6*(t-1);o.push(128|63&a),t-=1}return o}}s.prototype={decode:function(e,r){var t;t="object"==typeof e&&e instanceof ArrayBuffer?new Uint8Array(e):"object"==typeof e&&"buffer"in e&&e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(0),r=i(r),this._streaming||(this._decoder=new f({fatal:this._fatal}),this._BOMseen=!1),this._streaming=Boolean(r.stream);for(var n,a=new o(t),s=[];!a.endOfStream()&&-1!==(n=this._decoder.handler(a,a.read()));)null!==n&&(Array.isArray(n)?s.push.apply(s,n):s.push(n));if(!this._streaming){do{if(-1===(n=this._decoder.handler(a,a.read())))break;null!==n&&(Array.isArray(n)?s.push.apply(s,n):s.push(n))}while(!a.endOfStream());this._decoder=null}return s.length&&(-1===["utf-8"].indexOf(this.encoding)||this._ignoreBOM||this._BOMseen||(65279===s[0]?(this._BOMseen=!0,s.shift()):this._BOMseen=!0)),function(e){for(var r="",t=0;t<e.length;++t){var n=e[t];n<=65535?r+=String.fromCharCode(n):(n-=65536,r+=String.fromCharCode(55296+(n>>10),56320+(1023&n)))}return r}(s)}},u.prototype={encode:function(e,r){e=e?String(e):"",r=i(r),this._streaming||(this._encoder=new c(this._options)),this._streaming=Boolean(r.stream);for(var t,n=[],a=new o(function(e){for(var r=String(e),t=r.length,n=0,i=[];n<t;){var o=r.charCodeAt(n);if(o<55296||o>57343)i.push(o);else if(56320<=o&&o<=57343)i.push(65533);else if(55296<=o&&o<=56319)if(n===t-1)i.push(65533);else{var a=e.charCodeAt(n+1);if(56320<=a&&a<=57343){var s=1023&o,u=1023&a;i.push(65536+(s<<10)+u),n+=1}else i.push(65533)}n+=1}return i}(e));!a.endOfStream()&&-1!==(t=this._encoder.handler(a,a.read()));)Array.isArray(t)?n.push.apply(n,t):n.push(t);if(!this._streaming){for(;-1!==(t=this._encoder.handler(a,a.read()));)Array.isArray(t)?n.push.apply(n,t):n.push(t);this._encoder=null}return new Uint8Array(n)}}},596:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.encryptMegolmKeyFile=r.decryptMegolmKeyFile=void 0;var n,i,o,a=d(t(63)),s=d(t(17)),u=d(t(182)),f=t(13),c=(r.decryptMegolmKeyFile=(n=(0,f.coroutine)(s.default.mark((function e(r,t){var n,i,o,a,l,d,p,b,A,_,k,x,O,M;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=m(r)).length<1)){e.next=3;break}throw w("Invalid file: too short",(0,h._t)("Not a valid Tchap keyfile"));case 3:if(1===n[0]){e.next=6;break}throw w("Unsupported version",(0,h._t)("Not a valid Tchap keyfile"));case 6:if(!((i=n.length-69)<0)){e.next=9;break}throw w("Invalid file: too short",(0,h._t)("Not a valid Tchap keyfile"));case 9:return o=n.subarray(1,17),a=n.subarray(17,33),l=n[33]<<24|n[34]<<16|n[35]<<8|n[36],d=n.subarray(37,37+i),p=n.subarray(-32),e.next=16,(0,f.resolve)(c(o,l,t));case 16:return b=e.sent,A=(0,u.default)(b,2),_=A[0],k=A[1],x=n.subarray(0,-32),O=void 0,e.prev=22,e.next=25,(0,f.resolve)(v.verify({name:"HMAC"},k,p,x));case 25:O=e.sent,e.next=31;break;case 28:throw e.prev=28,e.t0=e.catch(22),w("subtleCrypto.verify failed: "+e.t0,g());case 31:if(O){e.next=33;break}throw w("hmac mismatch",(0,h._t)("Authentication check failed: incorrect password?"));case 33:return M=void 0,e.prev=34,e.next=37,(0,f.resolve)(v.decrypt({name:"AES-CTR",counter:a,length:64},_,d));case 37:M=e.sent,e.next=43;break;case 40:throw e.prev=40,e.t1=e.catch(34),w("subtleCrypto.decrypt failed: "+e.t1,g());case 43:return e.abrupt("return",(new y).decode(new Uint8Array(M)));case 44:case"end":return e.stop()}}),e,this,[[22,28],[34,40]])}))),function(e,r){return n.apply(this,arguments)}),r.encryptMegolmKeyFile=(i=(0,f.coroutine)(s.default.mark((function e(r,t,n){var i,o,a,l,h,d,y,b,m,_,k,x,O,M,C,S;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(n=n||{}).kdf_rounds||5e5,o=new Uint8Array(16),window.crypto.getRandomValues(o),a=new Uint8Array(16),window.crypto.getRandomValues(a),a[8]&=127,e.next=9,(0,f.resolve)(c(o,i,t));case 9:return l=e.sent,h=(0,u.default)(l,2),d=h[0],y=h[1],b=(new p).encode(r),m=void 0,e.prev=15,e.next=18,(0,f.resolve)(v.encrypt({name:"AES-CTR",counter:a,length:64},d,b));case 18:m=e.sent,e.next=24;break;case 21:throw e.prev=21,e.t0=e.catch(15),w("subtleCrypto.encrypt failed: "+e.t0,g());case 24:return _=new Uint8Array(m),k=1+o.length+a.length+4+_.length+32,x=new Uint8Array(k),O=0,x[O++]=1,x.set(o,O),O+=o.length,x.set(a,O),O+=a.length,x[O++]=i>>24,x[O++]=i>>16&255,x[O++]=i>>8&255,x[O++]=255&i,x.set(_,O),O+=_.length,M=x.subarray(0,O),C=void 0,e.prev=41,e.next=44,(0,f.resolve)(v.sign({name:"HMAC"},y,M));case 44:C=e.sent,e.next=50;break;case 47:throw e.prev=47,e.t1=e.catch(41),w("subtleCrypto.sign failed: "+e.t1,g());case 50:return S=new Uint8Array(C),x.set(S,O),e.abrupt("return",A(x));case 53:case"end":return e.stop()}}),e,this,[[15,21],[41,47]])}))),function(e,r,t){return i.apply(this,arguments)}),o=(0,f.coroutine)(s.default.mark((function e(r,t,n){var i,o,u,c,l,h,d,y;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Date,o=void 0,e.prev=2,e.next=5,(0,f.resolve)(v.importKey("raw",(new p).encode(n),{name:"PBKDF2"},!1,["deriveBits"]));case 5:o=e.sent,e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(2),w("subtleCrypto.importKey failed: "+e.t0,g());case 11:return u=void 0,e.prev=12,e.next=15,(0,f.resolve)(v.deriveBits({name:"PBKDF2",salt:r,iterations:t,hash:"SHA-512"},o,512));case 15:u=e.sent,e.next=21;break;case 18:throw e.prev=18,e.t1=e.catch(12),w("subtleCrypto.deriveBits failed: "+e.t1,g());case 21:return c=new Date,console.log("E2e import/export: deriveKeys took "+(c-i)+"ms"),l=u.slice(0,32),h=u.slice(32),d=v.importKey("raw",l,{name:"AES-CTR"},!1,["encrypt","decrypt"]).catch((function(e){throw w("subtleCrypto.importKey failed for AES key: "+e,g())})),y=v.importKey("raw",h,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]).catch((function(e){throw w("subtleCrypto.importKey failed for HMAC key: "+e,g())})),e.next=29,(0,f.resolve)(a.default.all([d,y]));case 29:return e.abrupt("return",e.sent);case 30:case"end":return e.stop()}}),e,this,[[2,8],[12,18]])}))),function(e,r,t){return o.apply(this,arguments)}),l=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}(t(594)),h=t(2);function d(e){return e&&e.__esModule?e:{default:e}}var p=window.TextEncoder;p||(p=l.TextEncoder);var y=window.TextDecoder;y||(y=l.TextDecoder);var v=window.crypto.subtle||window.crypto.webkitSubtle;function w(e,r){var t=new Error(e);return t.friendlyText=r,t}function g(){return(0,h._t)("Your browser does not support the required cryptography extensions")}var b="-----BEGIN MEGOLM SESSION DATA-----";function m(e){for(var r=(new y).decode(new Uint8Array(e)),t=0;;){var n=r.indexOf("\n",t);if(n<0)throw new Error("Header line not found");var i=r.slice(t,n).trim();if(t=n+1,i===b)break}for(var o=t;;){var a=r.indexOf("\n",t);if("-----END MEGOLM SESSION DATA-----"===r.slice(t,a<0?void 0:a).trim())break;if(a<0)throw new Error("Trailer line not found");t=a+1}var s=t;return function(e){for(var r=window.atob(e),t=new Uint8Array(r.length),n=0;n<r.length;n++)t[n]=r.charCodeAt(n);return t}(r.slice(o,s))}function A(e){var r=Math.ceil(e.length/96),t=new Array(r+3);t[0]=b;var n,i,o=0,a=void 0;for(a=1;a<=r;a++)t[a]=(n=e.subarray(o,o+96),i=void 0,i=String.fromCharCode.apply(null,n),window.btoa(i)),o+=96;return t[a++]="-----END MEGOLM SESSION DATA-----",t[a]="",(new p).encode(t.join("\n")).buffer}}}]);
//# sourceMappingURL=2.js.map